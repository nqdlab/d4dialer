<!DOCTYPE html>
<html>
  <head>
    <title>Phonebook</title>
    <meta charset="utf-8">
    {% csrf_token %}
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container mt-5">
      <div class="row border rounded shadow-sm">
        <div class="col-md-4 p-4 border-end d-flex flex-column align-items-start" style="justify-content: flex-start;">
          <h2 class="mb-3">Add Phone Number</h2>
          <div class="input-group mb-3">
            <input type="text" id="phoneInput" class="form-control" placeholder="Enter phone number" />
            <button id="addButton" class="btn btn-primary">Add</button>
          </div>
        </div>
        <div class="col-md-8 p-4 d-flex flex-column align-items-start">
          <h2 class="mb-3">Phone Numbers</h2>
          <ul id="phoneList" class="list-group w-100"></ul>
        </div>
      </div>
      <div class="d-flex justify-content-center mt-4">
        <button id="saveButton" class="btn btn-success px-5">Save</button>
      </div>
    </div>
    <script>
      const phoneInput = document.getElementById('phoneInput');
      const addButton = document.getElementById('addButton');
      const phoneList = document.getElementById('phoneList');
      const numbers = [];

      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
      const csrftoken = getCookie('csrftoken');

      addButton.addEventListener('click', function() {
        const value = phoneInput.value.trim();
        if (value) {
          numbers.push(value);
          renderList();
          phoneInput.value = '';
          phoneInput.focus();
        }
      });

      function renderList() {
        phoneList.innerHTML = '';
        numbers.forEach(num => {
          const li = document.createElement('li');
          li.textContent = num;
          li.className = 'list-group-item';
          phoneList.appendChild(li);
        });
      }

      saveButton.addEventListener('click', function() {
        // Example: send the first phone number as destination
        if (numbers.length === 0) {
          alert('Please add at least one phone number.');
          return;
        }
        fetch('http://172.25.108.14:8000/api/fusionpbx/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
          },
          body: JSON.stringify({
            endpoint: "6000",
            destination: "8000",
            action: "originate",
            token: "BqjUiAKGUP7kZTUYj13X9pvxMXULD0ev"
          })
        })
        .then(response => {
          if (response.ok) {
            alert('Call request sent!');
          } else {
            alert('Failed to send call request.');
          }
        })
        .catch(() => {
          alert('Error sending request.');
        });
      });

    </script>
    <!-- Bootstrap JS (optional, for some components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>